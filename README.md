# ![Logo](docs/logo.png) TapGate v.1 ( prototype )

**TapGate** is a standalone extension module for gate automation systems that adds the ability to control gate via a smartphone application.

### Goal
Develop a hardware - software system (IoT + client (mobile) app) for remote control of standard electronic gate controllers.

### Device Interaction
A single IoT device can be controlled by multiple instances of the client app:
```bash
             / 1 client app 
 IoT (ESP32) - 2 client app
             \ n client app
```

### Key Features

- **Local control via Bluetooth**
  Control the gate automation system from a smartphone at short range, without requiring an internet connection.

- **Remote control via Wi-Fi/Internet**
  Operate the system over the internet using MQTT (supports both sequred anonymous and authenticated access) when Bluetooth is not available.
  Supports anonymous MQTT servers when no external server is available.
  Encrypts and validates data sent over anonymous MQTT for added security.

- **Unified client app**
  A single client application with admin tools, handles onboarding, day-to-day control, and device management across BLE, Wi-Fi STA, and Wi-Fi AP channels.
  Users only need to install the mobile client, no browser flows or multiple interfaces are required during setup or later use.
  Direct access to every communication channel enables flexible provisioning, OTA upgrades, logging, and other management features from the same codebase.

- **Home Assistant integration**
  Integration with Home Assistant is possible via a trusted MQTT broker, either over the internet or within a local network.

### Communication: Parallel Use of Bluetooth and MQTT channels

Communication between the mobile client and the IoT device is implemented simultaneously across all available channels: Bluetooth (BLE) and MQTT (over Wi-Fi/Internet). This approach was chosen because it minimizes latency, the user always gets a response from the fastest channel, and ensures maximum reliability in scenarios where a connection may drop at any moment.<br>
At the same time, the system preserves the ability to control the device locally via BLE even without an Internet connection. Combining both channels provides flexibility across different usage scenarios - from local offline control to global access via MQTT-making the system universal and resilient to connection loss, while parallel operation reduces delays when establishing connections or when one of the channels is unstable.

**Security**: All data sent to the device is protected with modern encryption. Each message uses a fresh one-time key to keep the data private and to make sure old messages cannot be reused by attackers. The device also checks that the data was not changed on the way. Long-term secret keys are stored securely inside the device‚Äôs flash memory, which is protected by ESP32‚Äôs built-in hardware security (flash encryption and secure boot). Random values used for encryption are generated by the hardware random number generator to ensure strong security.

## ESP32 MCU Documentation  
For detailed information about the microcontroller firmware, architecture, and implementation notes,<br>
see [ESP32 MCU Documentation](esp32_mcu/README.md).  

## Mobile Client Documentation  
For details about the mobile application, communication flow, and integration with the ESP32 device,<br>
see [Mobile Client Documentation](mobile_client_MAUI/README.md).  

## üöÄ Quick Start

### Development Environment Setup

To set up the development environment for building this project:

**Windows:**
```cmd
setup-dev-env.bat
```

**Unix/Linux/macOS:**
```bash
./setup-dev-env.sh
```

This will automatically:
- Check system requirements (Python 3, Git, CMake)
- Install protobuf dependencies
- Verify nanopb generator functionality
- Test project build capability
- Provide next steps for ESP-IDF and MAUI setup

### Building Components

**ESP32 Firmware:**
```bash
cd esp32_mcu
idf.py build
```

**Host Tests:**
```bash
cd esp32_mcu
TAPGATE_BUILD_MODE=host cmake -S . -B build_host
cmake --build build_host
```

**MAUI Client:**
Open `tapgate_client/TapGateClient.sln` in Visual Studio.  


## üìú License
This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

## üìú Disclaimer
This component is provided "as is", without warranty of any kind. The authors are not liable for any damages arising from the use of this component. Use it at your own risk.

## ‚úçÔ∏è Author
Andrii Solomai
